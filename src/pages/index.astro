---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const projects = (await getCollection('projects'))
  .sort((a, b) => a.data.sort - b.data.sort)
  .slice(0, 4);
---

<BaseLayout title="Home">
  <section class="mb-16">
    <h1 class="font-serif text-3xl sm:text-4xl text-text-primary mb-6">
      Hey, I'm Parker.
    </h1>
    <div class="space-y-4 text-text-secondary" style="line-height: 1.8;">
      <p>
        I build technology. Twenty years of it. Trading systems at Two Sigma,
        media platforms at CoinDesk, startups from scratch, three acquisitions.
        Now I'm building AI systems that make people better at what they already do.
      </p>
      <p>
        This is where I share the work and the thinking behind it.
      </p>
    </div>
    <p class="text-text-muted mt-5 text-sm">
      <a href="/about">More about me</a> &middot;
      <a href="/now">What I'm up to right now</a>
    </p>
  </section>

  {projects.length > 0 && (
    <section class="mb-16">
      <div class="flex items-center justify-between mb-6">
        <h2 class="font-serif text-xl text-text-primary">Things I'm Building</h2>
        <a href="/projects" class="text-sm text-text-muted hover:text-text-secondary no-underline">
          See all
        </a>
      </div>
      <div class="space-y-5">
        {projects.map((project) => (
          <a
            href={project.data.url || `/projects`}
            class="group block no-underline"
            target={project.data.url ? '_blank' : undefined}
            rel={project.data.url ? 'noopener' : undefined}
          >
            <h3 class="font-medium text-text-primary group-hover:text-accent transition-colors">
              {project.data.title}
            </h3>
            <p class="text-sm text-text-muted mt-1">{project.data.description}</p>
          </a>
        ))}
      </div>
    </section>
  )}

  {posts.length > 0 && (
    <section>
      <div class="flex items-center justify-between mb-6">
        <h2 class="font-serif text-xl text-text-primary">Recent Writing</h2>
        <a href="/blog" class="text-sm text-text-muted hover:text-text-secondary no-underline">
          See all
        </a>
      </div>
      <div class="space-y-3">
        {posts.map((post) => (
          <a href={`/blog/${post.id}`} class="group flex items-baseline justify-between gap-4 no-underline">
            <span class="text-text-primary group-hover:text-accent transition-colors">
              {post.data.title}
            </span>
            <span class="shrink-0 text-sm text-text-muted tabular-nums">
              {post.data.date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
            </span>
          </a>
        ))}
      </div>
    </section>
  )}
</BaseLayout>
