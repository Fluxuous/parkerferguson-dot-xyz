---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const projects = (await getCollection('projects'))
  .sort((a, b) => a.data.sort - b.data.sort);

const grouped = {
  active: projects.filter(p => p.data.status === 'active'),
  shipped: projects.filter(p => p.data.status === 'shipped'),
  archived: projects.filter(p => p.data.status === 'archived'),
  idea: projects.filter(p => p.data.status === 'idea'),
};

const statusLabels: Record<string, string> = {
  active: 'In Progress',
  shipped: 'Shipped',
  archived: 'Archived',
  idea: 'On the Whiteboard',
};
---

<BaseLayout title="Projects" description="Things Parker Ferguson has built and is building.">
  <h1 class="font-serif text-3xl text-text-primary mb-3">Projects</h1>
  <p class="text-text-muted mb-10" style="line-height: 1.8;">
    What I'm building and what I've shipped.
  </p>

  {Object.entries(grouped).map(([status, items]) =>
    items.length > 0 && (
      <section class="mb-12">
        <h2 class="font-serif text-lg text-text-muted mb-5">
          {statusLabels[status] || status}
        </h2>
        <div class="space-y-6">
          {items.map((project) => (
            <div>
              <h3 class="font-medium text-text-primary">
                {project.data.url ? (
                  <a href={project.data.url} target="_blank" rel="noopener" class="no-underline hover:text-accent">
                    {project.data.title}
                  </a>
                ) : (
                  project.data.title
                )}
              </h3>
              <p class="text-sm text-text-secondary mt-1">{project.data.description}</p>
              {project.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mt-2">
                  {project.data.tags.map(tag => (
                    <span class="text-xs text-text-muted">{tag}</span>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      </section>
    )
  )}
</BaseLayout>
